<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="sv-SE" xml:lang="sv-SE"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>3&nbsp; tidyverse – Statistisk teori och tillämpningar i R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../01-regression/index.html" rel="next">
<link href="../00-programming/01-packages-and-functions.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-96e8a2c236aee144da7b9dc077376cca.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "Inget resultat",
    "search-matching-documents-text": "matchande dokument",
    "search-copy-link-title": "Kopiera länk för att söka",
    "search-hide-matches-text": "Göm ytterligare resultat",
    "search-more-match-text": "annat resultat i detta dokument",
    "search-more-matches-text": "fler resultat i detta dokument",
    "search-clear-button-title": "Rensa",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Avbryt",
    "search-submit-button-title": "Verkställ",
    "search-label": "Sök"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
<link rel="stylesheet" href="../webex.css">
</head>

<body class="nav-sidebar floating nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    </a>
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Statistisk teori och tillämpningar i R</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Skifta navigering" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="../00-programming/00-basics-R.html" aria-current="page"> 
<span class="menu-text">Programmering i R</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../01-regression/index.html"> 
<span class="menu-text">Regressionsanalys</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../02-variance/index.html"> 
<span class="menu-text">Varianssanalys</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../04-time-series/index.html"> 
<span class="menu-text">Tidsserieanalys</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Skifta sidonavigering" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../00-programming/00-basics-R.html"><strong>DEL I - Programmering i R</strong></a></li><li class="breadcrumb-item"><a href="../00-programming/02-tidyverse.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">tidyverse</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Skifta sidonavigering" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Sök" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="../index.html" class="sidebar-logo-link">
      </a>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Sök"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Inledning</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text"><strong>DEL I - Programmering i R</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Skifta sektion">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../00-programming/00-basics-R.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Grunderna i R</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../00-programming/01-packages-and-functions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Paket och funktioner</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../00-programming/02-tidyverse.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">tidyverse</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../01-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">DEL II - Regressionsanalys</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Skifta sektion">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../01-regression/00-intro-regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Introduktion till regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../01-regression/01-explorative-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Utforska samband</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../01-regression/02-model-structure.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Modellanpassning</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../01-regression/03-model-assessment.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Modellutvärdering</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../01-regression/04-statistical-inference.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Statistisk inferens</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../01-regression/05-simultaneous-inference.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Simultan inferens</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../01-regression/06-complex-predictors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Komplexa samband</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../01-regression/07-multicollinearity.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Multikollinearitet</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../01-regression/08-detailed-residuals.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Detaljerad residualanalys</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../01-regression/09-variable-selection.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Modellvalidering och variabelselektion</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../01-regression/10-logistic-regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Logistisk regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../01-regression/11-other-link-functions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Andra länkfunktioner</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../02-variance/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">DEL III - Variansanalys</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Skifta sektion">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../02-variance/00-oneway-anova.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Introduktion till variansanalys</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../02-variance/01-random-factors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Slumpmässiga faktorer</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../02-variance/02-control-variables.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Kontrollvariabler</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../02-variance/03-twoway-anova.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Tvåvägs-ANOVA</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../04-time-series/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">DEL IV - Tidsserieanalys</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Skifta sektion">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../04-time-series/00-introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Introduktion</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../04-time-series/01-properties.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Tidsserier</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../04-time-series/02-ar.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Autoregressiva modeller</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../04-time-series/03-arima.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">ARIMA</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../04-time-series/04-arimax.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">ARIMAx</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Innehållsförteckning</h2>
   
  <ul>
  <li><a href="#sec-readr" id="toc-sec-readr" class="nav-link active" data-scroll-target="#sec-readr"><span class="header-section-number">3.1</span> Läsa in filer med <code>readr</code></a></li>
  <li><a href="#sec-tibble" id="toc-sec-tibble" class="nav-link" data-scroll-target="#sec-tibble"><span class="header-section-number">3.2</span> Dataobjektet <code>tibble</code></a></li>
  <li><a href="#sec-tidyr" id="toc-sec-tidyr" class="nav-link" data-scroll-target="#sec-tidyr"><span class="header-section-number">3.3</span> Omformatera data med <code>tidyr</code></a></li>
  <li><a href="#koppla-samman-funktioner-med-pipes" id="toc-koppla-samman-funktioner-med-pipes" class="nav-link" data-scroll-target="#koppla-samman-funktioner-med-pipes"><span class="header-section-number">3.4</span> Koppla samman funktioner med pipes</a></li>
  <li><a href="#databearbetning-med-dplyr" id="toc-databearbetning-med-dplyr" class="nav-link" data-scroll-target="#databearbetning-med-dplyr"><span class="header-section-number">3.5</span> Databearbetning med <code>dplyr</code></a>
  <ul class="collapse">
  <li><a href="#byta-namn-på-variabler-med-rename" id="toc-byta-namn-på-variabler-med-rename" class="nav-link" data-scroll-target="#byta-namn-på-variabler-med-rename"><span class="header-section-number">3.5.1</span> Byta namn på variabler med <code>rename()</code></a></li>
  <li><a href="#plocka-ut-rader-med-filter" id="toc-plocka-ut-rader-med-filter" class="nav-link" data-scroll-target="#plocka-ut-rader-med-filter"><span class="header-section-number">3.5.2</span> Plocka ut rader med <code>filter()</code></a></li>
  <li><a href="#plocka-ut-kolumner-med-select" id="toc-plocka-ut-kolumner-med-select" class="nav-link" data-scroll-target="#plocka-ut-kolumner-med-select"><span class="header-section-number">3.5.3</span> Plocka ut kolumner med <code>select()</code></a></li>
  <li><a href="#byta-plats-på-variabler-med-relocate" id="toc-byta-plats-på-variabler-med-relocate" class="nav-link" data-scroll-target="#byta-plats-på-variabler-med-relocate"><span class="header-section-number">3.5.4</span> Byta plats på variabler med <code>relocate()</code></a></li>
  <li><a href="#sortera-data-med-arrange" id="toc-sortera-data-med-arrange" class="nav-link" data-scroll-target="#sortera-data-med-arrange"><span class="header-section-number">3.5.5</span> Sortera data med <code>arrange()</code></a></li>
  <li><a href="#skapa-nya-variabler-med-mutate" id="toc-skapa-nya-variabler-med-mutate" class="nav-link" data-scroll-target="#skapa-nya-variabler-med-mutate"><span class="header-section-number">3.5.6</span> Skapa nya variabler med <code>mutate()</code></a></li>
  <li><a href="#gruppera-beräkningar-med-group_by" id="toc-gruppera-beräkningar-med-group_by" class="nav-link" data-scroll-target="#gruppera-beräkningar-med-group_by"><span class="header-section-number">3.5.7</span> Gruppera beräkningar med <code>group_by()</code></a></li>
  <li><a href="#sammanfatta-data-med-summarize" id="toc-sammanfatta-data-med-summarize" class="nav-link" data-scroll-target="#sammanfatta-data-med-summarize"><span class="header-section-number">3.5.8</span> Sammanfatta data med <code>summarize()</code></a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../00-programming/00-basics-R.html"><strong>DEL I - Programmering i R</strong></a></li><li class="breadcrumb-item"><a href="../00-programming/02-tidyverse.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">tidyverse</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span id="sec-tidyverse" class="quarto-section-identifier"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">tidyverse</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>En stor del utav statistisk analys omfattar bearbetning av datamaterial som samlats in till ett format som lämpar sig för olika statistiska analysmetoder. Ett datamaterial som man själv samlar in (<em>primärdata</em>) eller datamaterial som hämtas från någon annan källa (<em>sekundärdata</em>) är inte alltid strukturerat på det sätt som vi, eller metoderna, önskar. <code>tidyverse</code> är en samling paket i R som har en gemensam grund att programmera, både i dess syntax och grammatik.</p>
<p>Inom statistik önskas data ofta följa formatet: “en rad är en observation”, “en kolumn är en variabel” och “en cell är ett värde”, så att vi med lätthet kan hantera datamaterialet på ett flertal olika sätt. Detta kan vi kalla för <em>rådata</em> eller <em>tidy data</em> och <a href="../01-regression/01-explorative-analysis.html#sec-example-data" class="quarto-xref"><span>Avsnitt 5.1</span></a> visar data på just detta format. Varje rad är en uppmätt pingvin och varje kolumn är mätvärden för varje variabel. Exempel på en struktur som inte följer denna praxis är frekvenstabeller där varje rad visar flera observationer som har samma variabelvärde.</p>
<p>Vi kan installera de paketen som ingår i <code>tidyverse</code> genom att installera paketet med samma namn och ladda in det i arbetsminnet med <code>require()</code> eller <code>library()</code>.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"tidyverse"</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(tidyverse)</span></code></pre></div><button title="Kopiera till urklipp" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>I detta kapitel kommer vi gå igenom de olika paketen som behandlar datastrukturer och olika variablertyper medan senare kapitel kommer fortsätta med paket för visualisering (<code>ggplot2</code>) och mer avancerad kodning (<code>purrr</code>).</p>
<section id="sec-readr" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="sec-readr"><span class="header-section-number">3.1</span> Läsa in filer med <code>readr</code></h2>
<p>R innehåller många inbyggda funktioner (se <a href="01-packages-and-functions.html#sec-readData" class="quarto-xref"><span>Avsnitt 2.2</span></a>) för hur man kan läsa in filer av olika format från hårddisken. Vi har tidigare tittat på <code>read.csv2()</code> som är en grundfunktion i R, men <code>readr</code> har liknande funktioner utöver flera andra specialfall som utgår från vissa standardformat för filer.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tips
</div>
</div>
<div class="callout-body-container callout-body">
<p>Det är starkt rekommenderat att läsa in text-filer i R, inte Excelfiler då Excel kan innehålla specialformat som R inte kan läsa in korrekt. Vi kan från Excel spara om en .xlsx fil till en .txt-, .tsv- eller .csv-fil.</p>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Läser in en textfil där kolumner separeras med en (eller flera) mellanslag (.txt)</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">read_table</span>(<span class="at">file =</span> <span class="st">"sökväg"</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Läser in en textfil där kolumner separeras med tab (.tsv)</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">read_tsv</span>(<span class="at">file =</span> <span class="st">"sökväg"</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Läser in en textfil där kolumner separeras med , (read_csv) eller ; (read_csv2)</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="fu">read_csv</span>(<span class="at">file =</span> <span class="st">"sökväg"</span>)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="fu">read_csv2</span>(<span class="at">file =</span> <span class="st">"sökväg"</span>)</span></code></pre></div><button title="Kopiera till urklipp" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Resultatet av dessa funktioner blir en formatterad <em>tibble</em>, vilket är <code>tidyverse</code> version av en <code>data frame</code>.</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Viktigt
</div>
</div>
<div class="callout-body-container callout-body">
<p>Se till att datamaterialet som laddats in ser ut som vi förväntar att det ska göra, exempelvis är decimaler korrekt angivna, har vi lika många variabler i R som i originalfilen och liknande.</p>
</div>
</div>
</section>
<section id="sec-tibble" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="sec-tibble"><span class="header-section-number">3.2</span> Dataobjektet <code>tibble</code></h2>
<p>I <a href="00-basics-R.html#sec-data-frame" class="quarto-xref"><span>Avsnitt 1.2.4.3</span></a> presenterades datastrukturen <code>data frame</code> som ett sätt för oss att i R spara information i ett strukturerat rådataformat. En <code>tibble</code> är en utbyggnad av denna datastruktur som rensat bort egenskaper av objektet som inte längre används och lägger till egenskaper som vi ofta vill använda när vi bearbetar data. Likt en <code>data frame</code>, innehåller en <code>tibble</code> en samling lika långa kolumner och dessa kolumner kan vara av olika objekttyper. Till exempel kan vi blanda listor och vektorer så länge de innehåller lika många element.</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Viktigt
</div>
</div>
<div class="callout-body-container callout-body">
<p>En <code>tibble</code> konverterar inte textvektorer till faktorer per automatik. Det vill säga om ett datamaterial som läses in via <code>read_csv2()</code> innehåller text, kommer denna variabel vara ett <code>character</code>-objekt, inte ett <code>Factor</code>-objekt.</p>
</div>
</div>
<p>Vi kan skapa en <code>tibble</code> från grunden genom att ange vilka objekt vi vill inkludera och vad de ska heta:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>c <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Skapar en tibble utifrån angivna vektorer</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> </span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">Var1 =</span> a,</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">Var2 =</span> b,</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">Var3 =</span> c</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Skriver ut tibble till konsollen</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(data)</span></code></pre></div><button title="Kopiera till urklipp" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
   Var1  Var2 Var3 
  &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;
1     1     4 a    
2     2     5 b    
3     3     6 c    </code></pre>
</div>
</div>
<p>En direkt utskrift av en <code>tibble</code> innehåller både dimensionerna av hela objektet och vad för typ respektive variabel är.</p>
<p>Om vi har en matris eller något annat objekt som ser ut som en tibble men inte är det, kan vi konvertera den till en tibble med hjälp av <code>as_tibble()</code>.</p>
<div class="cell">
<details class="code-fold">
<summary>Visa kod</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tar objektet a (en vektor) och gör om den till formatet tibble innehållande en kolumn</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>vectorToTibble <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(a)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(vectorToTibble)</span></code></pre></div><button title="Kopiera till urklipp" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 1
  value
  &lt;dbl&gt;
1     1
2     2
3     3</code></pre>
</div>
</div>
</section>
<section id="sec-tidyr" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="sec-tidyr"><span class="header-section-number">3.3</span> Omformatera data med <code>tidyr</code></h2>
<p>En utav de tyngsta delarna av statistisk analys är ofta att bearbeta data till det format som önskas. Paketet <code>tidyr</code> innehåller ett flertal funktioner som kan bearbeta data på många olika sätt</p>
<p>Om data inte är på det format som vi önskar eller om någon statistisk metod behöver ett material som har ett annat format än tidy-data. Detta paket kommer vi inte titta på just nu i detalj men följande Cheat Sheets innehåller exempel på olika bearbetningar som vi kan vara intresserade av att genomföra med data.</p>
<div class="cell">
<div class="cell-output-display">
<a href="https://github.com/rstudio/cheatsheets/blob/master/tidyr.pdf" class="external-link" target="blank"><img src="https://raw.githubusercontent.com/rstudio/cheatsheets/master/pngs/thumbnails/tidyr-thumbs.png"></a>
</div>
</div>
</section>
<section id="koppla-samman-funktioner-med-pipes" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="koppla-samman-funktioner-med-pipes"><span class="header-section-number">3.4</span> Koppla samman funktioner med pipes</h2>
<p>Inom programmering, speciellt databearbetning, är det vanligt att vi vill skapa ett objekt, göra någon bearbetning på den, använda den i en statistisk analys och så vidare. Att nästla funktioner inuti varandra blir lätt väldigt krångligt att läsa och förstå vad som faktiskt händer eller vilka argument som hör till vilken funktion. Alternativet är att spara om objektet flera gånger men då skapas många onödiga objekt som vi måste hålla koll på och som egentligen bara tar upp plats i arbetsminnet.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fyra nästlade funktioner som ska appliceras på ett objekt med olika argument</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">funktion4</span>(<span class="fu">funktion3</span>(<span class="fu">funktion2</span>(<span class="fu">funktion1</span>(objekt), <span class="at">argument2 =</span> X)), <span class="at">argument4 =</span> Y)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Fyra funktioner som sparas vid varje steg</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>A <span class="ot">&lt;-</span> <span class="fu">funktion1</span>(objekt)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>B <span class="ot">&lt;-</span> <span class="fu">funktion2</span>(A, <span class="at">argument2 =</span> X)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>C <span class="ot">&lt;-</span> <span class="fu">funktion3</span>(B)</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>D <span class="ot">&lt;-</span> <span class="fu">funktion4</span>(C, <span class="at">argument4 =</span> Y)</span></code></pre></div><button title="Kopiera till urklipp" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Inom modern R-programmering används istället en annan process som kallas för <strong>programmeringspipes</strong> som kan skapa sekvenser av funktioner som är sammanlänkade i varandra. Från baspaketet används operatorn <code>|&gt;</code> som kan skapas med kortkommandot Ctrl + Shift + M (CMD + Shift + M). Denna operator tar resultatet från funktionen innan <code>|&gt;</code> och skickar vidare det som det första argumentet i funktionen efter <code>|&gt;</code>.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Samma operation av fyra funktioner men med piping</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>objekt <span class="sc">|&gt;</span> </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">funktion1</span>() <span class="sc">|&gt;</span> </span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">funktion2</span>(<span class="at">argument2 =</span> X) <span class="sc">|&gt;</span> </span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">funktion3</span>() <span class="sc">|&gt;</span> </span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">funktion4</span>(<span class="at">argument4 =</span> Y)</span></code></pre></div><button title="Kopiera till urklipp" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Funktioner som inte behöver fler än ett argument skrivs bara ut som funktionen med tomma parenteser då resultatet används automatiskt som värdet på det argumentet. Funktioner som har ytterligare argument behöver bara ange de argument som inte använder sig av det tidigare resultatet.</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Viktigt
</div>
</div>
<div class="callout-body-container callout-body">
<p>Det kan finnas funktioner som vill använda det tidigare resultatet i ett argument som inte är det första i funktionen. Som tur är kan vi lösa detta genom att använda <code>_</code> som symbolen för det tidigare resultatet och ange det vid argumentet som är aktuellt.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Objektet (_) läggs här in som värde för det andra argumentet i funktionen</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>objekt <span class="sc">|&gt;</span> </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">funktion5</span>(<span class="at">argument1 =</span> X, <span class="at">argument2 =</span> _)</span></code></pre></div><button title="Kopiera till urklipp" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p><code>|&gt;</code> är något begränsat med detta men som tur är finns dess “kusin” från paketet <code>dplyr</code> <code>%&gt;%</code> som fungerar på mestadels samma sätt men tillåter mer flexibilitet var objektet från tidigare i pipen placeras i den nuvarande funktionen. Det vi måste tänka på är att vi här byter symbol till <code>.</code> istället för <code>_</code> för att beskriva objektet.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Objektet (.) läggs här in som värde för det andra argumentet i funktionen</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>objekt <span class="sc">%&gt;%</span> </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">funktion5</span>(<span class="at">argument1 =</span> X, <span class="at">argument2 =</span> .)</span></code></pre></div><button title="Kopiera till urklipp" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
</div>
</section>
<section id="databearbetning-med-dplyr" class="level2" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="databearbetning-med-dplyr"><span class="header-section-number">3.5</span> Databearbetning med <code>dplyr</code></h2>
<p>Med hjälp av de tidigare kapitlen och det “nya” sättet att skriva sekvenser av funktioner med pipes kan vi nu börja titta närmare på databearbetning av objekt till en <code>tibble</code>. Det är vanligt att vi i databearbetning behöver göra flera steg för att skapa det objekt vi sen vill analysera och då kommer <code>|&gt;</code> mycket väl till pass.</p>
<p><code>dplyr</code> innehåller ett flertal olika “verb” som på ett sätt eller annat bearbetar data. Det första argumentet i alla dessa funktioner är ett dataobjekt men om vi använder pipes kommer det ske per automatik och vi behöver endast fokusera på de andra argumentet som beskriver hur “verbet” används.</p>
<section id="byta-namn-på-variabler-med-rename" class="level3" data-number="3.5.1">
<h3 data-number="3.5.1" class="anchored" data-anchor-id="byta-namn-på-variabler-med-rename"><span class="header-section-number">3.5.1</span> Byta namn på variabler med <code>rename()</code></h3>
<p>Data som läses in till R kan ibland ha konstiga och långa namn som vid programmering kan bli svåra att hantera. Ett sätt att underlätta detta problem är att döpa om variablerna till ett enkelt ord som vi sedan kan använda i efterföljande steg.</p>
<p>Vi kan döpa om variabler med hjälp av <code>rename()</code> där vi anger det nya namnet givet det gamla namnet på variabeln eller variabelns kolumnindex.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Döper om variabler till svenska namn utifrån det gamla namnet</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>penguins <span class="sc">|&gt;</span> </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">art =</span> species,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    näbblängd <span class="ot">=</span> bill_length_mm</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Kopiera till urklipp" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 333 × 8
   art    island    näbblängd bill_depth_mm flipper_length_mm body_mass_g sex   
   &lt;fct&gt;  &lt;fct&gt;         &lt;dbl&gt;         &lt;dbl&gt;             &lt;int&gt;       &lt;int&gt; &lt;fct&gt; 
 1 Adelie Torgersen      39.1          18.7               181        3750 male  
 2 Adelie Torgersen      39.5          17.4               186        3800 female
 3 Adelie Torgersen      40.3          18                 195        3250 female
 4 Adelie Torgersen      36.7          19.3               193        3450 female
 5 Adelie Torgersen      39.3          20.6               190        3650 male  
 6 Adelie Torgersen      38.9          17.8               181        3625 female
 7 Adelie Torgersen      39.2          19.6               195        4675 male  
 8 Adelie Torgersen      41.1          17.6               182        3200 female
 9 Adelie Torgersen      38.6          21.2               191        3800 male  
10 Adelie Torgersen      34.6          21.1               198        4400 male  
# ℹ 323 more rows
# ℹ 1 more variable: year &lt;int&gt;</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Döper om variabler till svenska namn utifrån dess kolumnindex</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>penguins <span class="sc">|&gt;</span> </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">art =</span> <span class="dv">1</span>,</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    näbblängd <span class="ot">=</span> <span class="dv">3</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Kopiera till urklipp" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 333 × 8
   art    island    näbblängd bill_depth_mm flipper_length_mm body_mass_g sex   
   &lt;fct&gt;  &lt;fct&gt;         &lt;dbl&gt;         &lt;dbl&gt;             &lt;int&gt;       &lt;int&gt; &lt;fct&gt; 
 1 Adelie Torgersen      39.1          18.7               181        3750 male  
 2 Adelie Torgersen      39.5          17.4               186        3800 female
 3 Adelie Torgersen      40.3          18                 195        3250 female
 4 Adelie Torgersen      36.7          19.3               193        3450 female
 5 Adelie Torgersen      39.3          20.6               190        3650 male  
 6 Adelie Torgersen      38.9          17.8               181        3625 female
 7 Adelie Torgersen      39.2          19.6               195        4675 male  
 8 Adelie Torgersen      41.1          17.6               182        3200 female
 9 Adelie Torgersen      38.6          21.2               191        3800 male  
10 Adelie Torgersen      34.6          21.1               198        4400 male  
# ℹ 323 more rows
# ℹ 1 more variable: year &lt;int&gt;</code></pre>
</div>
</div>
</section>
<section id="plocka-ut-rader-med-filter" class="level3" data-number="3.5.2">
<h3 data-number="3.5.2" class="anchored" data-anchor-id="plocka-ut-rader-med-filter"><span class="header-section-number">3.5.2</span> Plocka ut rader med <code>filter()</code></h3>
<p>Om vi är intresserade av att plocka ut vissa rader ur ett objekt, till exempel om vi vill rensa bort saknade värden, kan vi använda <code>filter()</code> med någon logisk operator som säger vilka rader vi vill ha kvar.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filtrerar bort observationer som saknar information ur variabeln "sex"</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>penguinsNonMissing <span class="ot">&lt;-</span> </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  penguins <span class="sc">|&gt;</span> </span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(sex))</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(penguinsNonMissing)</span></code></pre></div><button title="Kopiera till urklipp" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 333 × 8
   species island    bill_length_mm bill_depth_mm flipper_length_mm body_mass_g
   &lt;fct&gt;   &lt;fct&gt;              &lt;dbl&gt;         &lt;dbl&gt;             &lt;int&gt;       &lt;int&gt;
 1 Adelie  Torgersen           39.1          18.7               181        3750
 2 Adelie  Torgersen           39.5          17.4               186        3800
 3 Adelie  Torgersen           40.3          18                 195        3250
 4 Adelie  Torgersen           36.7          19.3               193        3450
 5 Adelie  Torgersen           39.3          20.6               190        3650
 6 Adelie  Torgersen           38.9          17.8               181        3625
 7 Adelie  Torgersen           39.2          19.6               195        4675
 8 Adelie  Torgersen           41.1          17.6               182        3200
 9 Adelie  Torgersen           38.6          21.2               191        3800
10 Adelie  Torgersen           34.6          21.1               198        4400
# ℹ 323 more rows
# ℹ 2 more variables: sex &lt;fct&gt;, year &lt;int&gt;</code></pre>
</div>
</div>
<p>Vi kan också plocka ut rader som uppfyller ett visst kriterie, till exempel plocka ut alla Adelie pingviner.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>penguins <span class="sc">|&gt;</span> </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(species <span class="sc">==</span> <span class="st">"Adelie"</span>)</span></code></pre></div><button title="Kopiera till urklipp" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 146 × 8
   species island    bill_length_mm bill_depth_mm flipper_length_mm body_mass_g
   &lt;fct&gt;   &lt;fct&gt;              &lt;dbl&gt;         &lt;dbl&gt;             &lt;int&gt;       &lt;int&gt;
 1 Adelie  Torgersen           39.1          18.7               181        3750
 2 Adelie  Torgersen           39.5          17.4               186        3800
 3 Adelie  Torgersen           40.3          18                 195        3250
 4 Adelie  Torgersen           36.7          19.3               193        3450
 5 Adelie  Torgersen           39.3          20.6               190        3650
 6 Adelie  Torgersen           38.9          17.8               181        3625
 7 Adelie  Torgersen           39.2          19.6               195        4675
 8 Adelie  Torgersen           41.1          17.6               182        3200
 9 Adelie  Torgersen           38.6          21.2               191        3800
10 Adelie  Torgersen           34.6          21.1               198        4400
# ℹ 136 more rows
# ℹ 2 more variables: sex &lt;fct&gt;, year &lt;int&gt;</code></pre>
</div>
</div>
</section>
<section id="plocka-ut-kolumner-med-select" class="level3" data-number="3.5.3">
<h3 data-number="3.5.3" class="anchored" data-anchor-id="plocka-ut-kolumner-med-select"><span class="header-section-number">3.5.3</span> Plocka ut kolumner med <code>select()</code></h3>
<p>Anta att vi bara är intresserade av vissa kolumner från ett stort datamaterial, till exempel art och fenlängd av pingvinerna kan vi plocka ut de med hjälp av <code>select()</code>. Vi kan antingen använda variablernas faktiska namn eller variablernas kolumnindex för att specificera vilka variabler som ska plockas ut.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Select med variabelnamn</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>penguins <span class="sc">|&gt;</span> </span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(species, flipper_length_mm)</span></code></pre></div><button title="Kopiera till urklipp" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 333 × 2
   species flipper_length_mm
   &lt;fct&gt;               &lt;int&gt;
 1 Adelie                181
 2 Adelie                186
 3 Adelie                195
 4 Adelie                193
 5 Adelie                190
 6 Adelie                181
 7 Adelie                195
 8 Adelie                182
 9 Adelie                191
10 Adelie                198
# ℹ 323 more rows</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Select med kolumnindex</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>penguins <span class="sc">|&gt;</span> </span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="dv">1</span>, <span class="dv">5</span>)</span></code></pre></div><button title="Kopiera till urklipp" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 333 × 2
   species flipper_length_mm
   &lt;fct&gt;               &lt;int&gt;
 1 Adelie                181
 2 Adelie                186
 3 Adelie                195
 4 Adelie                193
 5 Adelie                190
 6 Adelie                181
 7 Adelie                195
 8 Adelie                182
 9 Adelie                191
10 Adelie                198
# ℹ 323 more rows</code></pre>
</div>
</div>
<p>Det rekommenderas att använda variabelnamnen för att koden ska vara tydlig att läsa av och vi vet vilka variabler som faktiskt plockas ut och ev. skickas vidare till efterföljande funktioner.</p>
<p>Om vi har flera variabler som följer efter varandra behöver vi inte skriva upp varje enskilda variabelnamn som argument utan kan använda <code>Var1:Var5</code> för att säga åt funktionen att plocka ut alla variabler från och med <code>Var1</code> till och med <code>Var5</code>.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>penguins <span class="sc">|&gt;</span> </span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(species, bill_length_mm<span class="sc">:</span>body_mass_g)</span></code></pre></div><button title="Kopiera till urklipp" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 333 × 5
   species bill_length_mm bill_depth_mm flipper_length_mm body_mass_g
   &lt;fct&gt;            &lt;dbl&gt;         &lt;dbl&gt;             &lt;int&gt;       &lt;int&gt;
 1 Adelie            39.1          18.7               181        3750
 2 Adelie            39.5          17.4               186        3800
 3 Adelie            40.3          18                 195        3250
 4 Adelie            36.7          19.3               193        3450
 5 Adelie            39.3          20.6               190        3650
 6 Adelie            38.9          17.8               181        3625
 7 Adelie            39.2          19.6               195        4675
 8 Adelie            41.1          17.6               182        3200
 9 Adelie            38.6          21.2               191        3800
10 Adelie            34.6          21.1               198        4400
# ℹ 323 more rows</code></pre>
</div>
</div>
</section>
<section id="byta-plats-på-variabler-med-relocate" class="level3" data-number="3.5.4">
<h3 data-number="3.5.4" class="anchored" data-anchor-id="byta-plats-på-variabler-med-relocate"><span class="header-section-number">3.5.4</span> Byta plats på variabler med <code>relocate()</code></h3>
<p>Ibland kan vi vilja byta ordning på variablerna i datamaterialet utan att välja dem. Med <code>select()</code> får vi en möjlighet att välja vilken ordning som variablerna plockas ut, den ordning som vi anger dem i funktionen, men om vi bara vill flytta på variabler utan att plocka ut vissa kan <code>relocate()</code> användas istället.</p>
<p>Funktionen använder sig av tre argument, vilka variabler som ska flyttas och var de ska placeras. Som standard placeras de i början av datamaterialet.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Placerar fenlängd som första kolumnen</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>penguins <span class="sc">|&gt;</span> </span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(flipper_length_mm)</span></code></pre></div><button title="Kopiera till urklipp" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 333 × 8
   flipper_length_mm species island    bill_length_mm bill_depth_mm body_mass_g
               &lt;int&gt; &lt;fct&gt;   &lt;fct&gt;              &lt;dbl&gt;         &lt;dbl&gt;       &lt;int&gt;
 1               181 Adelie  Torgersen           39.1          18.7        3750
 2               186 Adelie  Torgersen           39.5          17.4        3800
 3               195 Adelie  Torgersen           40.3          18          3250
 4               193 Adelie  Torgersen           36.7          19.3        3450
 5               190 Adelie  Torgersen           39.3          20.6        3650
 6               181 Adelie  Torgersen           38.9          17.8        3625
 7               195 Adelie  Torgersen           39.2          19.6        4675
 8               182 Adelie  Torgersen           41.1          17.6        3200
 9               191 Adelie  Torgersen           38.6          21.2        3800
10               198 Adelie  Torgersen           34.6          21.1        4400
# ℹ 323 more rows
# ℹ 2 more variables: sex &lt;fct&gt;, year &lt;int&gt;</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Placerar art efter näbbreddens variabel</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>penguins <span class="sc">|&gt;</span> </span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(species, <span class="at">.after =</span> bill_depth_mm)</span></code></pre></div><button title="Kopiera till urklipp" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 333 × 8
   island    bill_length_mm bill_depth_mm species flipper_length_mm body_mass_g
   &lt;fct&gt;              &lt;dbl&gt;         &lt;dbl&gt; &lt;fct&gt;               &lt;int&gt;       &lt;int&gt;
 1 Torgersen           39.1          18.7 Adelie                181        3750
 2 Torgersen           39.5          17.4 Adelie                186        3800
 3 Torgersen           40.3          18   Adelie                195        3250
 4 Torgersen           36.7          19.3 Adelie                193        3450
 5 Torgersen           39.3          20.6 Adelie                190        3650
 6 Torgersen           38.9          17.8 Adelie                181        3625
 7 Torgersen           39.2          19.6 Adelie                195        4675
 8 Torgersen           41.1          17.6 Adelie                182        3200
 9 Torgersen           38.6          21.2 Adelie                191        3800
10 Torgersen           34.6          21.1 Adelie                198        4400
# ℹ 323 more rows
# ℹ 2 more variables: sex &lt;fct&gt;, year &lt;int&gt;</code></pre>
</div>
</div>
</section>
<section id="sortera-data-med-arrange" class="level3" data-number="3.5.5">
<h3 data-number="3.5.5" class="anchored" data-anchor-id="sortera-data-med-arrange"><span class="header-section-number">3.5.5</span> Sortera data med <code>arrange()</code></h3>
</section>
<section id="skapa-nya-variabler-med-mutate" class="level3" data-number="3.5.6">
<h3 data-number="3.5.6" class="anchored" data-anchor-id="skapa-nya-variabler-med-mutate"><span class="header-section-number">3.5.6</span> Skapa nya variabler med <code>mutate()</code></h3>
</section>
<section id="gruppera-beräkningar-med-group_by" class="level3" data-number="3.5.7">
<h3 data-number="3.5.7" class="anchored" data-anchor-id="gruppera-beräkningar-med-group_by"><span class="header-section-number">3.5.7</span> Gruppera beräkningar med <code>group_by()</code></h3>
</section>
<section id="sammanfatta-data-med-summarize" class="level3" data-number="3.5.8">
<h3 data-number="3.5.8" class="anchored" data-anchor-id="sammanfatta-data-med-summarize"><span class="header-section-number">3.5.8</span> Sammanfatta data med <code>summarize()</code></h3>
<!-- ## Hantering av text med `stringr` och `forcats` -->


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Kopierat!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Kopierat!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../00-programming/01-packages-and-functions.html" class="pagination-link" aria-label="Paket och funktioner">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Paket och funktioner</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../01-regression/index.html" class="pagination-link" aria-label="DEL II - Regressionsanalys">
        <span class="nav-page-text">DEL II - Regressionsanalys</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<script>

// Script to highlight the current section in the navbar depending on which page you are on

document.addEventListener("DOMContentLoaded", function() {

    const currentPath = window.location.pathname;

    const navLinks = document.querySelectorAll(".navbar-nav .nav-link");



    navLinks.forEach(link => {

        const linkPath = new URL(link.href).pathname;



        // Highlight parent section if current path starts with link path

        if (currentPath.startsWith(linkPath)) {

            link.classList.add("active");

        } else {

            link.classList.remove("active");

        }

    });

});

</script>

<script>



/* definition of content for the buttons */

const webex_buttons = {check_hidden:          "<b>&check;</b>",

                       check_hidden_alt:      "Check answer",

                       check_shown:           "<b>&lsh;</b>",

                       check_shown_alt:       "Hide check",

                       check_of_total:        "/",

                       solution:              "<b>&quest;</b>",

                       solution_alt:          "Correct solution",

                       question_next:         "<b>&#8634;</b>",

                       question_next_alt:     "Next question",

                       question_previous:     "",

                       question_previous_alt: ""}





/* update total correct if #webex-total_correct exists */

update_total_correct = function() {

  console.log("webex: update total_correct");



  document.querySelectorAll(".webex-total_correct").forEach(total => {

    p = total.closest(".webex-box");

    var correct = p.getElementsByClassName("webex-correct").length;

    var solvemes = p.getElementsByClassName("webex-solveme").length;

    var radiogroups = p.getElementsByClassName("webex-radiogroup").length;

    var selects = p.getElementsByClassName("webex-select").length;

    /* no specific class on input node, thus searching via query selector */

    var checkboxgroups = p.querySelectorAll("div[class=webex-checkboxgroup] input[type=checkbox]").length



    /* show number of correct / total number of answers */

    total.innerHTML = correct + "&nbsp;" + webex_buttons.check_of_total + "&nbsp;" + (solvemes + radiogroups + checkboxgroups + selects);

  });

}



/* check answers */

check_func = function() {

  console.log("webex: check answer");



  //var cl = elem.parentElement.classList;

  var cl = this.closest(".webex-box").classList;

  if (cl.contains("unchecked")) {

    cl.remove("unchecked");

    this.innerHTML = webex_buttons.check_shown; //"Hide check";

    if (webex_buttons.check_shown_alt.length > 0) this.setAttribute("title", webex_buttons.check_shown_alt);

  } else {

    cl.add("unchecked");

    this.innerHTML = webex_buttons.check_hidden; //"Check answer";

    if (webex_buttons.check_hidden_alt.length > 0) this.setAttribute("title", webex_buttons.check_hidden_alt);

  }

}



/* helper functions for checking the webex ID */

const id_checker = {"fmt": new RegExp("[g-zG-Z]"),

                    "load": function(e) { return e.getAttribute("id").match("(?<=(-)).*$")[0]; },

                    "eval": new TextEncoder(),

                    "dval": new TextDecoder()}



/* Show/hide correct solution */

solution_func = function() {

  console.log("webex: show/hide solution");



  var div = this.closest(".webex-question").querySelector(".webex-solution");

  var cl = div.classList;



  if (cl.contains("visible")) {

    cl.remove("visible");

  } else {

    cl.add("visible");

  }

}



/* function to check if the real answer is numeric */

convert_to_numeric = function(x) {

  if (typeof x == "string") {

    /* do nothing */

  } else if (x.length == 1) {

    /* take first element */

    x = x[0]

  } else {

    return NaN;

  }



  /* remove spaces for easier parsing */

  x = x.replace(/\s/g, "");



  /* Define patterns for different formats, note that spaces have been removed above */

  const patterns = [

    {regex: /^[+-]?\d+(\.\d{3})*,\d+$/, decimal: ",", thousand: "." },  // Format: "1.100.100.100,3"

    {regex: /^[+-]?\d+(,\d{3})*\.\d+$/, decimal: ".", thousand: "," },  // Format: "1,100,100,100.3"

    {regex: /^[+-]?\d+(\.|\.\d+)?$/, decimal: "." },                    // Format: "1100100100.5" or "1100100100."

    {regex: /^[+-]?\d+(,|,\d+)$/, decimal: "," }                        // Format: "1100100100,5" or "1100100100,"

  ];





  /* testing all regular expressions, convert to float if possible */

  for (const { regex, decimal, thousand } of patterns) {

    if (regex.test(x)) {

      let numeric = x;

      if (thousand) numeric = numeric.replace(new RegExp(`\\${thousand}`, "g"), "");

      numeric = numeric.replace(decimal, ".");

      return parseFloat(numeric);

    }

  }



  /* input of length 1 but none of the known formats, return NaN */

  return NaN;

}



/* Checking webex ID, returns formalsol */

check_id = function(e) {

  /* loading webex ID */

  var id = id_checker["load"](e);



  /* extracting answer */

  let answer = e.dataset.answer;



  /* checking unique id, prepare and return array */

  if (!id_checker["fmt"].test(id)) {

    const a = id_checker["eval"].encode(atob(answer));

    const b = id_checker["eval"].encode(id);

    const res = a.map((byte, index) => byte^b[index % b.length]);

    answer = id_checker["dval"].decode(res);

    /* Replacing &amp; with ' before parsing */

    answer = answer.replaceAll("&apos;", "'");

  }



  return JSON.parse(answer);

}



/* function for checking solveme answers */

solveme_func = function(e) {

  /* avoid that keyup and keychange twice execute this function within nms = 10

   * ms, clearing inputTimer and add timeout */

  console.log("webex: check solveme");



  /* float, precision for checking numeric answers */

  const eps = 0.00000000000001;



  /* get last checked user answer */

  const question = this.closest(".webex-question")



  /* extracting classes */

  var cl = this.classList;

  var my_answer = this.value;



  /* extracting classes */

  var cl = this.classList;



  /* empty answer? Job done */

  if (my_answer == "") {

    cl.remove("webex-correct");

    cl.remove("webex-incorrect");

    return false;

  }



  /* Find closest (parent) webex-question */

  let formalsols = check_id(this)



  /* by default we assume the users' answer is incorrect */

  var user_answer_correct = false;



  /* check if the correct answer is numeric, i.e. if 

   * formalsols is of length 1 containing one single numeric

   * value in a known format, else, NaN is returned */

  const num_formalsol = convert_to_numeric(formalsols);

  const num_my_answer = convert_to_numeric(my_answer);



  /* if the correct answer is numeric (float), the user's answer

   * must also be numeric. If not, it is wrong. Else we can

   * compare floating point numbers */

  if (!isNaN(num_formalsol) && !isNaN(num_my_answer)) {

    /* check if the real answer and the user input are numerically the same;

     * adding 'delta' to avoid precision issues */

    var diff = Math.abs(num_formalsol - num_my_answer);

    if (diff < parseFloat(this.dataset.tol) + eps) { user_answer_correct = true; }



  /* if the question contains regex, a regular expression is used

   * to evaluate the users answer. Allows for multiple regular expressions */

  } else if (cl.contains("regex")) {

    for (let i = 0; i < formalsols.length; i++) {

        let regex = new RegExp(formalsols[i], cl.contains("ignorecase") ? "i" : "");

        if (regex.test(my_answer)) { user_answer_correct = true; break; }

    }



  /* else we evaluate on 'string level', considering the creators preferences

   * regarding set options */

  } else {

    /* modify/prepare answer */

    if (cl.contains("ignorecase")) { my_answer = my_answer.toLowerCase(); }

    if (cl.contains("nospaces"))   { my_answer = my_answer.replace(/ /g, ""); }



    /* if the real answer includes user input - correct */

    if (formalsols.includes(my_answer)) {

      user_answer_correct = true;

  

      // added regex bit

      if (cl.contains("regex")) {

        answer_regex = RegExp(formalsols.join("|"))

        if (answer_regex.test(my_answer)) {

          cl.add("webex-correct");

        }

      }

    }

  }



  if (user_answer_correct) {

      cl.add("webex-correct");

      cl.remove("webex-incorrect");

  } else {

      cl.add("webex-incorrect");

      cl.remove("webex-correct");

  }



  update_total_correct();



}



/* function for checking select answers */

select_func = function(e) {

  console.log("webex: check select");



  var options   = [];

  Array.from(this.querySelectorAll("option")).forEach((option, index) => {

    if (!option.hasAttribute("value") || !option.getAttribute("value") === "blank") {

      options.push(option);

    }

  });



  /* get selected option */

  function get_selected(options) { return options.findIndex(option => option.selected); }

  var option_index = get_selected(options)



  /* loading webex ID */

  var formalsol = check_id(this)



  /* add class for current selection */

  this.classList.remove("webex-incorrect");

  this.classList.remove("webex-correct");

  if (option_index >= 0) {

    this.classList.add(formalsol[option_index] === 1 ? "webex-correct" : "webex-incorrect");

  }



  update_total_correct();

}



/* function for checking radiogroups answers */

radiogroups_func = function(e) {

  console.log("webex: check radiogroups");



  /* get real answer (binary integer array) */

  var id = e.target.getAttribute("name");

  var group = document.querySelector(".webex-radiogroup[id='webex-" + id + "']");

  var formalsol = check_id(group)



  /* check which radiobuttion is selected (user answer) */

  function get_checked(radios) {

    return radios.findIndex(radios => radios.checked);

  }

  var radios = Array.from(group.querySelectorAll("input[type='radio']"))

  var radio_index = get_checked(radios);



  /* remove existing classes */

  radios.forEach(radio => {

    let cl = radio.closest("label").classList

    cl.remove("webex-incorrect");

    cl.remove("webex-correct");

  });



  /* add class for current selection */

  let cl = radios[radio_index].closest("label").classList

  if (formalsol[radio_index] === 1) {

      cl.add("webex-correct");

  } else {

      cl.add("webex-incorrect");

  }



  update_total_correct();

}





/* function for checking checkboxgroups answers */

checkboxgroups_func = function(e) {

  console.log("webex: check checkboxgroups");



  /* get real answer (binary integer array) */

  var group = document.querySelector(".webex-checkboxgroup[id='" + this.id + "']");

  var formalsol = check_id(group);



  /* check which checkbox is checked (user answer) */

  function get_checked(group) {

      const checkboxes = Array.from(group.querySelectorAll("input[type='checkbox']"));

      return checkboxes.reduce((indices, checkbox, index) => {

          if (checkbox.checked) indices.push(index);

          return indices;

      }, []);

  }

  var checks = Array.from(group.querySelectorAll("input[type='checkbox']"));

  var check_index = get_checked(group);



  checks.forEach((e, index) => {

    var label = e.parentNode;

    var ans = formalsol[index];

    if ((e.checked && ans === 1) || (!e.checked && ans === 0)) {

        label.setAttribute("class", "webex-correct")

    } else {

        label.setAttribute("class", "webex-incorrect")

    }

  });



  update_total_correct();

}



/* shuffling array (thanks to stack overflow)

 * If argument x is an integer we create an integer sequence

 * from 0, 1, ..., (x - 1) and return a shuffled version. If

 * the input is an array, we simply shuffle it */

shuffle_array = function(x) {

   if (Number.isInteger(x) && !isNaN(x)) {

     x = Array.from({length: x}, (v, i) => i);

   }

   let shuffled = x.map(value => ({ value, sort: Math.random() }))

        .sort((a, b) => a.sort - b.sort).map(({ value }) => value)

   return shuffled;

}



/* ---------------------------------------------------------

 * ---------------------------------------------------------

 * --------------------------------------------------------- */

window.onload = function() {

  //console.log("webex: onload");



  /* setting up buttons and actions to show/hide answers */

  document.querySelectorAll(".webex-check").forEach(section => {

    section.classList.add("unchecked");



    /* ul to take up the list items with buttons */

    let button_ul = document.createElement("ul");

    button_ul.setAttribute("class", "webex-button-list");

    section.appendChild(button_ul);



    /* button to _check_ if answers given are correct */

    let li_check = document.createElement("li");

    button_ul.appendChild(li_check); /* add list item to ul */

    let btn_check = document.createElement("button");

    btn_check.innerHTML = webex_buttons.check_hidden;  // "Check answer";

    btn_check.setAttribute("class", "webex-button webex-button-check");

    if (webex_buttons.check_hidden_alt.length > 0) btn_check.setAttribute("title", webex_buttons.check_hidden_alt);

    btn_check.onclick = check_func;

    li_check.appendChild(btn_check);



    /* span to show current number of points (when _check_ active) */

    let spn = document.createElement("span");

    spn.classList.add("webex-total_correct");

    li_check.appendChild(spn);



    /* button to show the _solution_ if there is one */

    var has_solution = section.parentNode.querySelectorAll(".webex-solution").length > 0;

    if (has_solution) {

      let li_solution = document.createElement("li");

      button_ul.appendChild(li_solution); /* add list item to ul */

      let btn_solution = document.createElement("button");

      btn_solution.innerHTML = webex_buttons.solution; // "Correct answer";

      btn_solution.setAttribute("class", "webex-button webex-button-solution");

      if (webex_buttons.solution_alt.length > 0) btn_solution.setAttribute("title", webex_buttons.solution_alt);

      btn_solution.onclick = solution_func;

      li_solution.appendChild(btn_solution);

    }



  });



  /* set up webex-solveme inputs */

  document.querySelectorAll(".webex-solveme").forEach(solveme => {

    solveme.setAttribute("autocomplete","off");

    solveme.setAttribute("autocorrect", "off");

    solveme.setAttribute("autocapitalize", "off");

    solveme.setAttribute("spellcheck", "false");

    solveme.value = "";



    /* adjust answer for 'no spaces' (ignore spaces) */

    if (solveme.classList.contains("nospaces")) {

      solveme.dataset.answer = solveme.dataset.answer.replace(/ /g, "");

    }



    /* attach checking function, triggered on key up, change, and when

     * elemnt is out of focus. Only evaluated once by tracking changes

     * via variable solveme_last_user_answer */

    solveme.addEventListener("keyup",  solveme_func);

    solveme.addEventListener("change", solveme_func);

    solveme.addEventListener("blur",   solveme_func);



    /* adding span to show correct/incorrect icon */

    solveme.insertAdjacentHTML("afterend", " <span class='webex-icon'></span>")

  });



  /* set up radiogroups (single choice questions with display = "buttons") */

  document.querySelectorAll(".webex-radiogroup").forEach(radiogroup => {

    radiogroup.onchange = radiogroups_func;

  });



  /* set up checkboxgroups (multiple choice questions with display = "buttons") */

  document.querySelectorAll(".webex-checkboxgroup").forEach(checkboxgroup => {

    checkboxgroup.onchange = checkboxgroups_func;

  });



  /* set up selects (dropdown menus) */

  document.querySelectorAll(".webex-select").forEach(select => {

    select.onchange = select_func;

    /* append webex-icon for correct/incorrect icons */

    var elem = document.createElement("span")

    elem.classList.add("webex-icon")

    select.parentNode.appendChild(elem)

  });



  /* change to next/previous question if multiple are available */

  function handleQuestionClick(group, questions, step) {

    return async function() {

      /* get question order as integer vector */

      let questionOrder = group.dataset.questionOrder.split(",").map(str => parseInt(str));



      /* current question/position */

      let currentPosition = parseInt(group.dataset.currentPosition);



      /* Hide the current question */

      questions.forEach(question => { question.classList.remove("active"); });



      /* Move to the next question index */

      currentPosition = (currentPosition + step) % questionOrder.length;

      if (currentPosition < 0) currentPosition = currentPosition + questionOrder.length



      /* Display the new question */

      questions[questionOrder[currentPosition]].classList.add("active");



      // Update the currentPosition data attribute on the group div

      group.dataset.currentPosition = currentPosition;

    };

  }



  document.querySelectorAll(".webex-group").forEach(group => {

    const questions = Array.from(group.querySelectorAll(".webex-question"));



    /* Create vector with question order. If the webex-group does

     * not have class '.noshuffle' we will randomly shuffle the order */

    let questionOrder = Array.from({length: questions.length}, (v, i) => i);

    if (!group.classList.contains("noshuffle")) {

      questionOrder = shuffle_array(questionOrder);

    }



    /* take start position (if set) or start at 0 */

    const currentPosition = parseInt(group.getAttribute("data-start-position")) || 0;



    /* show the default question for each group */

    questions[questionOrder[currentPosition]].classList.add("active");



    /* store random order of questions as well as current position */

    group.dataset.questionOrder   = questionOrder;

    group.dataset.currentPosition = currentPosition;



    /* find all webex-questions, search for .webex-button-list and

     * populate the list with necessary <li><button>...</button></li> elements */

    questions.forEach(question => {

        let button_ul = question.querySelector("ul.webex-button-list");



        let li_next = document.createElement("li");

        let nextButton = document.createElement("button");

        nextButton.setAttribute("class", "webex-button webex-button-next");

        if (webex_buttons.question_next_alt.length > 0) nextButton.setAttribute("title", webex_buttons.question_next_alt);

        nextButton.innerHTML = webex_buttons.question_next; // "Next question";

        nextButton.addEventListener("click", handleQuestionClick(group, questions, 1));

        li_next.appendChild(nextButton);



        let li_previous = document.createElement("li");

        let previousButton = document.createElement("button");

        previousButton.setAttribute("class", "webex-button webex-button-previous");

        if (webex_buttons.question_previous_alt.length > 0) previousButton.setAttribute("title", webex_buttons.question_previous_alt);

        previousButton.innerHTML = webex_buttons.question_previous; // "Previous question";

        previousButton.addEventListener("click", handleQuestionClick(group, questions, -1));

        li_previous.appendChild(previousButton);



        if (webex_buttons.question_previous.length > 0) button_ul.appendChild(li_previous);

        if (webex_buttons.question_next.length > 0) button_ul.appendChild(li_next);

    });

  });



  /* Development options */

  document.querySelectorAll(".webex-question.check").forEach(question => {

      question.querySelector(".webex-button-check").click()

  });

  document.querySelectorAll(".webex-question.solution").forEach(question => {

      let btn = question.querySelector(".webex-button-solution");

      if (btn !== null) { btn.click(); }

  });



  /* Pre-filling <input> fields */

  document.querySelectorAll(".webex-question.prefill").forEach(question => {

      question.querySelectorAll("input.webex-solveme").forEach(solveme => {

          let x = JSON.parse(solveme.dataset.answer);

          solveme.value = x[0];

          /* Trigger the on change event */

          solveme.dispatchEvent(new Event("change"));

      });



      /* Pre-filling radiogroups, that is for schoice questions */

      question.querySelectorAll(".webex-radiogroup").forEach(radiogroup => {

          let x = JSON.parse(radiogroup.dataset.answer);

          let idx = x.indexOf(1);

          let radios = radiogroup.querySelectorAll('input[type="radio"]');

          radios[idx].checked = true;

          /* Trigger the on change event */

          radios[idx].dispatchEvent(new Event("change", { bubbles: true }));

      });



      /* Pre-filling checkboxgroups, that is for schoice questions w/ dropdown menus */

      question.querySelectorAll(".webex-select").forEach(dropdown => {

          let x = JSON.parse(dropdown.dataset.answer);

          let idx = x.indexOf(1) + 1; /* +1 to skip the first blank option */

          let options = dropdown.querySelectorAll("option");

          options[idx].selected = true;

          /* Trigger the on change event */

          options[idx].dispatchEvent(new Event("change", { bubbles: true }));

      });



      /* Pre-filling checkboxgroups, that is for mchoice questions */

      question.querySelectorAll(".webex-checkboxgroup").forEach(radiogroup => {

          let x = JSON.parse(radiogroup.dataset.answer);

          let checkboxes = radiogroup.querySelectorAll('input[type="checkbox"]');

          for (let i = 0; i < checkboxes.length; i++) {

              checkboxes[i].checked = x[i];

          }

          /* Trigger the on change event */

          checkboxes[0].dispatchEvent(new Event("change", { bubbles: true }));

      });

  });



  /* Show set tolerance (devel option) */

  function calc_width(x, txt, offset = 20) {

      /* We do the following:

       * Create a new span, insert the value we need in the .tolerance

       * input node, and calculate its offsetWidth. Then remove it

       * again; this is just used to calculate the required width. */

      var cwtmp = document.createElement("span");

      x.appendChild(cwtmp);

      cwtmp.innerHTML = txt || "";

      var w = parseInt(cwtmp.getBoundingClientRect().width) + offset;

      cwtmp.remove();

      return w;

  }



  /* If tolerance should be shown (devel option) we calculate:

   * - the width required to properly display the solution

   * - the width required to properly display the tolerance

   * - add a new element to display the tolerance

   * - reduce the width of the solution input box. */

  document.querySelectorAll(".webex-question.tolerance").forEach(question => {

      question.querySelectorAll("input[data-tol]").forEach(elem => {

          var w = null;



          /* Add new element showing the tolerance */

          let tol = document.createElement("input");

          tol.type = "text"; // <inpyt type="text">

          tol.disabled = true; // Disable input element

          tol.classList.add("tolerance"); // Appending class

          tol.value = "Â± " + elem.getAttribute("data-tol");



          /* Add new node */

          elem.parentNode.insertBefore(tol, elem)



          var body     = document.querySelector("body");

          //tol.value = "Â± " + "0.0000007";

          //tol.value = "Â± " + "0.07";

          w    = calc_width(body, tol.value);

          wold = parseInt(elem.getBoundingClientRect().width);

          wmin = calc_width(body, elem.value);



          /* Calculate required width of the 'tolerance' node, and the

           * reduction of the original 'input' node */

          let wnew = Math.max(wmin, wold - w);

          tol.style.width  = w + "px";

          elem.style.width = wnew + "px";

      });

  });



  update_total_correct();

}



</script>




</body></html>